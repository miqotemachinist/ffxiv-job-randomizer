<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FFXIV Job Randomizer</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
  <script src='Winwheel.min.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.4.2/gsap.min.js"></script>
</head>
<style>
  body {
    font-family: "Open Sans", sans-serif;
  }
  
  .job-roulette-section{
    display: grid;
    grid-template-columns: 500px auto;
  }

  .job-item{
    display: grid;
  }

  .job-group{
    display: grid;
    grid-template-columns: repeat(4, 50px);
  }

  .form-jobs{
    display: grid;
    grid-gap: 20px;
  }

  .jobs{
    display: grid;
    grid-gap: 10px;
  }

  .team-list{

  }

  .party-member{
    display: grid;
    grid-template-columns: 50px 150px auto;
  }
</style>

<body>
  <section>
    <h1>FFXIV Job Randomizer</h1>
    <p>For a super fun time in FFXIV</p>
  </section>
  <section class="job-roulette-section">
    <canvas id='canvas' width='500' height='500'>
      Canvas not supported, use another browser.
    </canvas>
    <div class="input-form">
      <div class="job-selections">
        <form class="form-jobs" onchange="jobFormChange()">
          <div class="info">
            <div class="info-item">
              <label for="name">Name</label>
              <input type="text" name="name" id="name">
            </div>
            <div class="info-item">
              <label for="server">Server</label>
              <input type="text" name="server" id="server" disabled >
            </div>
            <div class="info-item">
              <button disabled>Import</button>
            </div>
          </div>
          <div class="jobs">
            <div class="job-group tanks">
              <div class="job-item">
                <label for="pld">PLD</label>
                <input type="checkbox" checked name="pld" id="pld">
              </div>
              <div class="job-item">
                <label for="war">WAR</label>
                <input type="checkbox" checked name="war" id="war">
              </div>
              <div class="job-item">
                <label for="drk">DRK</label>
                <input type="checkbox" checked name="drk" id="drk">
              </div>
              <div class="job-item">
                <label for="gnb">GNB</label>
                <input type="checkbox" checked name="gnb" id="gnb">
              </div>
            </div>
            <div class="job-group melee">
              <div class="job-item">
                <label for="mnk">MNK</label>
                <input type="checkbox" checked name="mnk" id="mnk">
              </div>
              <div class="job-item">
                <label for="drg">DRG</label>
                <input type="checkbox" checked name="drg" id="drg">
              </div>
              <div class="job-item">
                <label for="nin">NIN</label>
                <input type="checkbox" checked name="nin" id="nin">
              </div>
              <div class="job-item">
                <label for="sam">SAM</label>
                <input type="checkbox" checked name="sam" id="sam">
              </div>
            </div>
            <div class="job-group ranged">
              <div class="job-item">
                <label for="brd">BRD</label>
                <input type="checkbox" checked name="brd" id="brd">
              </div>
              <div class="job-item">
                <label for="mch">MCH</label>
                <input type="checkbox" checked name="mch" id="mch">
              </div>
              <div class="job-item">
                <label for="dnc">DNC</label>
                <input type="checkbox" checked name="dnc" id="dnc">
              </div>
            </div>
            <div class="job-group caster">
              <div class="job-item">
                <label for="blm">BLM</label>
                <input type="checkbox" checked name="blm" id="blm">
              </div>
              <div class="job-item">
                <label for="smn">SMN</label>
                <input type="checkbox" checked name="smn" id="smn">
              </div>
              <div class="job-item">
                <label for="rdm">RDM</label>
                <input type="checkbox" checked name="rdm" id="rdm">
              </div>
            </div>
            <div class="job-group healer">
              <div class="job-item">
                <label for="whm">WHM</label>
                <input type="checkbox" checked name="whm" id="whm">
              </div>
              <div class="job-item">
                <label for="sch">SCH</label>
                <input type="checkbox" checked name="sch" id="sch">
              </div>
              <div class="job-item">
                <label for="ast">AST</label>
                <input type="checkbox" checked name="ast" id="ast">
              </div>
            </div>
          </div>

        </form>
      </div>
      <div class="button-wrapper">
        <button class="randomize-button" onClick="spinTheWheel()">RANDOMIZE!</button>
      </div>
    </div>
  </section>
  <section class="resulting-team">
    <div class="spin-result">
      <h2></h2>
    </div>
    <div class="team-list-wrapper">
      <div class="team-list-header">
        <h3>Party Members</h3>
      </div>
      <div class="team-list">
      
      </div>
    </div>
  </section>
</body>
<script>
  const jobs = {
    pld: {
      name: 'Paladin',
      color: '#a8d2e6',
      icon: ''
    },
    war: {
      name: 'Warrior',
      color: '#cf2621',
      icon: ''
    },
    drk: {
      name: 'Dark Knight',
      color: '#d126cc',
      icon: ''
    },
    gnb: {
      name: 'Gunbreaker',
      color: '#796d30',
      icon: ''
    },

    drg: {
      name: 'Dragoon',
      color: '#4164CD',
      icon: ''
    },
    mnk: {
      name: 'Monk',
      color: '#d69c00',
      icon: ''
    },
    nin: {
      name: 'Ninja',
      color: '#bF2974',
      icon: ''
    },
    sam: {
      name: 'Samurai',
      color: '#e46d04',
      icon: ''
    },

    blm: {
      name: 'Black Mage',
      color: '#A579D6',
      icon: ''
    },
    smn: {
      name: 'Summoner',
      color: '#2D9B78',
      icon: ''
    },
    rdm: {
      name: 'Red Mage',
      color: '#e87b7b',
      icon: ''
    },

    mch: {
      name: 'Machinist',
      color: '#6EE1D6',
      icon: ''
    },
    brd: {
      name: 'Bard',
      color: '#91ba5e',
      icon: ''
    },
    dnc: {
      name: 'Dancer',
      color: '#e2b0af',
      icon: ''
    },

    whm: {
      name: 'White Mage',
      color: '#fff0dc',
      icon: ''
    },
    sch: {
      name: 'Scholar',
      color: '#8657ff',
      icon: ''
    },
    ast: {
      name: 'Astrologian',
      color: '#ffe74a',
      icon: ''
    }

  }

  const spinFinished = () => {
    let selected = theWheel.getIndicatedSegment();
    document.querySelector('.spin-result > h2').innerHTML = `You will be playing as a(an) ${selected.text} (${selected.id})`;
    console.log(selected);

    let formData = new FormData(document.querySelector('.form-jobs'));
    roster.push({
      name: formData.get('name'),
      job: selected.id
    });
    updateRoster();


    isSpinning = false;
  }

  const spinTheWheel = () => {
    let name = document.getElementById('name').value;
    if(!name){
      alert('Please enter a name');
      return;
    }

    let segments = getJobsSegments();
    if(segments.length < 1){
      alert('Please select 1 or more jobs');
      return;
    }

    if(!isSpinning){
      isSpinning = true;
      theWheel = setupWheel(getJobsSegments());
      theWheel.startAnimation();
    }
  }

  const setupWheel = (segmentsArr) => {
    if (!segmentsArr){
      segmentsArr = getJobsSegments();
    }
    return new Winwheel({
      'numSegments': segmentsArr.length,
      'outerRadius': 200,
      'textFontSize': 18,
      'pointerAngle': 0,
      'segments': segmentsArr,
      'animation': {
        'type': 'spinToStop',
        'duration': 5,
        'spins': 8,
        'callbackFinished': 'spinFinished()'
      },
      'pointerGuide': {
        'display': true,
        'strokeStyle': 'red',
        'lineWidth': 3
      }
    });
  }

  const getJobsSegments = () => {
    let formData = new FormData(document.querySelector('.form-jobs'));
    let newSegments = [];
    Object.keys(jobs).forEach((job)=>{
      let jobSelect = formData.get(job);
      if(jobSelect){
        newSegments.push({
          fillStyle: jobs[job].color,
          text: jobs[job].name,
          id: job
        });
      }
    })

    return newSegments;
  }

  const jobFormChange = () => {
    theWheel = setupWheel(getJobsSegments());
    theWheel.draw();
  }

  const updateRoster = () => {
    let rosterContainer = document.querySelector('.team-list');
    rosterContainer.innerHTML = roster.reduce((total, curr)=>{
      return total + `
      <div class="party-member">
        <div class="job-icon">${curr.job.toUpperCase()}</div>
        <div class="job-title">${jobs[curr.job].name}</div>
        <div class="player">${curr.name}</div>
      </div>
      `
    }, '');
  }

  var roster = [];
  var theWheel = setupWheel();
  var isSpinning = false;
  
</script>

</html>